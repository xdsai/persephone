var De=Object.defineProperty;var Be=(o,e,t)=>e in o?De(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var te=(o,e,t)=>(Be(o,typeof e!="symbol"?e+"":e,t),t);import{S as Le,i as Ve,s as ye,e as x,b as V,H as ee,h,o as Pe,P as Ce,k,q as E,a as C,l as g,m as y,r as I,c as O,n as d,G as c,K as W,u as G,M as oe,Q as re,L as we,O as Ee}from"./index.0cd60f9d.js";import{m as ie}from"./marked.esm.da5dbf02.js";const Oe=["heat","cyber","empathy","credits","corpRep"];function ae(o){return structuredClone?structuredClone(o):JSON.parse(JSON.stringify(o))}function Ae(o,e){const t={ally_johnny:"ally_gotara",ally_gotara:"ally_johnny"};if(o[e]!==void 0)return o[e];if(o.flags&&o.flags[e]!==void 0)return o.flags[e];const n=t[e];if(n&&o.flags&&o.flags[n]!==void 0)return o.flags[n]}function ce(o,e){const t=Ae(e,o.var),n=o.value;switch(o.op){case"=":return t===n;case"!=":return t!==n;case"<":return Number(t)<Number(n);case"<=":return Number(t)<=Number(n);case">":return Number(t)>Number(n);case">=":return Number(t)>=Number(n)}return console.warn("Unknown operator",o.op),!1}function Me(o,e,t){var n;if(o){for(const l of Oe)typeof o[l]=="number"&&(e[l]+=o[l]);typeof o.shortMode=="boolean"&&(e.shortMode=!!o.shortMode);for(const[l,s]of Object.entries(o))l!=="addLore"&&typeof s=="boolean"&&(l==="ally_johnny"&&(e.flags.ally_gotara=s),l==="ally_gotara"&&(e.flags.ally_johnny=s),e.flags[l]=s);if(o.addLore){const l=Array.isArray(o.addLore)?o.addLore:[o.addLore];for(const s of l){if(!s)continue;((n=t.loreRegistry)==null?void 0:n.some(a=>a.slug===s))&&!e.loreDiscoveries.includes(s)&&e.loreDiscoveries.push(s)}}}}class Ue{constructor(e){te(this,"json");te(this,"nodesById");te(this,"currentId");te(this,"state");te(this,"history",[]);if(this.json=e,this.nodesById=new Map(e.nodes.map(t=>[t.id,t])),this.state=ae(e.meta.state),this.state.canRoam===void 0&&(this.state.canRoam=!0),this.currentId=e.start,!this.nodesById.has(this.currentId)){console.warn("Start node missing:",this.currentId);const t=e.nodes[0];this.currentId=(t==null?void 0:t.id)||""}}getState(){return this.state}getMeta(){return this.json.meta}getLore(){const e=this.json.meta.loreRegistry||[];return(this.state.loreDiscoveries||[]).map(t=>e.find(n=>n.slug===t)).filter(Boolean)}reset(){this.state=ae(this.json.meta.state),this.state.canRoam===void 0&&(this.state.canRoam=!0),this.currentId=this.json.start,this.history=[]}current(){const e=this.nodesById.get(this.currentId);return e||{id:this.currentId,text:"Unknown node. The story data is missing this passage.",choices:[]}}isEnding(){return this.current().type==="ending"}visibleChoices(){const e=this.current();if(e.type==="ending")return[];const t=e.choices||[],n=[];for(const l of t){if(!this.nodesById.has(l.to)){console.warn("Invalid choice target",l.to,"from",e.id);continue}let s=!0;if(l.conditions&&l.conditions.length)for(const r of l.conditions){if(!["=","!=","<","<=",">",">="].includes(r.op)){console.warn("Unknown operator in condition",r.op,"on",e.id),s=!1;break}if(!ce(r,this.state)){s=!1;break}}s&&n.push(l)}return n}passes(e){const t=e.conditions||[];for(const n of t){if(!["=","!=","<","<=",">",">="].includes(n.op))return console.warn("Unknown operator in condition",n.op),!1;if(!ce(n,this.state))return!1}return!0}renderableChoices(){const e=this.current();if(e.type==="ending")return[];const t=e.choices||[],n=!!(this.json.meta.ux&&this.json.meta.ux.showLockedChoices),l=[],s=new Map,r=(f,v)=>{if(this.passes(f))return{choice:f,enabled:!0,idx:v};if(n&&!!f.showIfLocked){const j=f.lockedText&&String(f.lockedText).trim()?String(f.lockedText):"Requirements not met.";return{choice:f,enabled:!1,reason:j,idx:v}}return null};t.forEach((f,v)=>{if(f.slug){const _=r(f,v);if(_){const w=s.get(f.slug)||[];w.push(_),s.set(f.slug,w)}}else{const _=r(f,v);_&&l.push(_)}});const a={done:3,available:2,locked:1},u=[];for(const[f,v]of s.entries()){if(!v.length)continue;let _=null,w=-1;for(const j of v){const N=j.choice.variant||"available",p=a[N]??0;p>w?(_=j,w=p):p===w&&_&&(j.enabled&&!_.enabled||j.enabled===_.enabled&&j.idx<_.idx)&&(_=j)}_&&u.push(_)}const i=u.concat(l);return i.sort((f,v)=>f.idx-v.idx),i.map(({idx:f,...v})=>v)}getFlow(){return this.json.meta.flow||{}}getHistoryLength(){return this.history.length}canBack(){return!!(this.state.canRoam&&this.history.length>0)}back(){if(!this.state.canRoam)return!1;const e=this.history.pop();return!e||!this.nodesById.has(e)?!1:(this.currentId=e,!0)}goTo(e,t=!0){return this.nodesById.has(e)?(this.state.canRoam&&t&&this.history.push(this.currentId),this.currentId=e,this.checkLockIn(),!0):(console.warn("goTo: unknown node",e),!1)}checkLockIn(){const t=this.getFlow().lockAtNodeIds||[];this.state.canRoam&&t.includes(this.currentId)&&(this.state.canRoam=!1,this.history=[])}choose(e){const n=this.visibleChoices()[e];if(!n){console.warn("Invalid choice index",e);return}Me(n.effects,this.state,this.json.meta),this.state.canRoam&&this.history.push(this.currentId),this.currentId=n.to,this.checkLockIn()}serialize(){const e={currentId:this.currentId,state:this.state,history:this.history.slice()};return JSON.stringify(e)}deserialize(e){try{const t=JSON.parse(e);if(!t||typeof t.currentId!="string"||!t.state)throw new Error("bad save");this.nodesById.has(t.currentId)?this.currentId=t.currentId:(console.warn("Saved node missing, falling back to start:",t.currentId),this.currentId=this.json.start),this.state=t.state,this.state.canRoam===void 0&&(this.state.canRoam=!0),this.history=Array.isArray(t.history)?t.history.filter(n=>this.nodesById.has(n)):[]}catch(t){console.warn("Failed to load save:",t)}}}const ue="persephone-run-v1:save";function fe(o,e,t){const n=o.slice();return n[46]=e[t],n}function he(o,e,t){const n=o.slice();return n[49]=e[t],n[51]=t,n}function He(o){let e,t,n,l,s,r,a,u,i,f=o[3]?"Hide Lore":"Lore",v,_,w,j,N,p=o[0].getState().flags.blogPosted&&!o[0].getState().flags.blogClean,m,P,A=o[6],F,K,J,D=o[7]&&de(o),T=o[8]&&pe(o),U=p&&ve(),q=me(o),B=o[3]&&ke(o);return{c(){e=k("div"),t=k("div"),n=k("div"),l=E("NEON THIRTEEN: PERSEPHONE RUN"),s=C(),D&&D.c(),r=C(),T&&T.c(),a=C(),u=k("div"),i=k("button"),v=E(f),_=C(),w=k("button"),j=E("Reset"),N=C(),U&&U.c(),m=C(),P=k("div"),q.c(),F=C(),B&&B.c(),this.h()},l(S){e=g(S,"DIV",{class:!0,role:!0,"aria-label":!0,tabindex:!0,style:!0});var L=y(e);t=g(L,"DIV",{class:!0});var M=y(t);n=g(M,"DIV",{class:!0});var R=y(n);l=I(R,"NEON THIRTEEN: PERSEPHONE RUN"),R.forEach(h),s=O(M),D&&D.l(M),r=O(M),T&&T.l(M),a=O(M),u=g(M,"DIV",{class:!0});var Y=y(u);i=g(Y,"BUTTON",{class:!0});var Q=y(i);v=I(Q,f),Q.forEach(h),_=O(Y),w=g(Y,"BUTTON",{class:!0});var Z=y(w);j=I(Z,"Reset"),Z.forEach(h),Y.forEach(h),M.forEach(h),N=O(L),U&&U.l(L),m=O(L),P=g(L,"DIV",{class:!0});var $=y(P);q.l($),$.forEach(h),F=O(L),B&&B.l(L),L.forEach(h),this.h()},h(){d(n,"class","title svelte-1jw8pec"),d(i,"class","btn svelte-1jw8pec"),d(w,"class","btn svelte-1jw8pec"),d(u,"class","actions svelte-1jw8pec"),d(t,"class","hud svelte-1jw8pec"),d(P,"class","pane svelte-1jw8pec"),d(e,"class","wrap svelte-1jw8pec"),d(e,"role","group"),d(e,"aria-label","persephone run"),d(e,"tabindex","0"),d(e,"style",`--gdur:${o[12].toFixed(2)}s; --gdelay:${o[13].toFixed(2)}s`)},m(S,L){V(S,e,L),c(e,t),c(t,n),c(n,l),c(t,s),D&&D.m(t,null),c(t,r),T&&T.m(t,null),c(t,a),c(t,u),c(u,i),c(i,v),c(u,_),c(u,w),c(w,j),c(e,N),U&&U.m(e,null),c(e,m),c(e,P),q.m(P,null),c(e,F),B&&B.m(e,null),K||(J=[W(i,"click",o[28]),W(w,"click",o[19]),W(e,"keydown",o[24])],K=!0)},p(S,L){S[7]?D?D.p(S,L):(D=de(S),D.c(),D.m(t,r)):D&&(D.d(1),D=null),S[8]?T?T.p(S,L):(T=pe(S),T.c(),T.m(t,a)):T&&(T.d(1),T=null),L[0]&8&&f!==(f=S[3]?"Hide Lore":"Lore")&&G(v,f),L[0]&1&&(p=S[0].getState().flags.blogPosted&&!S[0].getState().flags.blogClean),p?U||(U=ve(),U.c(),U.m(e,m)):U&&(U.d(1),U=null),L[0]&64&&ye(A,A=S[6])?(q.d(1),q=me(S),q.c(),q.m(P,null)):q.p(S,L),S[3]?B?B.p(S,L):(B=ke(S),B.c(),B.m(e,null)):B&&(B.d(1),B=null)},d(S){S&&h(e),D&&D.d(),T&&T.d(),U&&U.d(),q.d(S),B&&B.d(),K=!1,oe(J)}}}function qe(o){let e,t;return{c(){e=k("div"),t=E("loading story…"),this.h()},l(n){e=g(n,"DIV",{class:!0});var l=y(e);t=I(l,"loading story…"),l.forEach(h),this.h()},h(){d(e,"class","loading svelte-1jw8pec")},m(n,l){V(n,e,l),c(e,t)},p:ee,d(n){n&&h(e)}}}function Fe(o){let e,t;return{c(){e=k("div"),t=E(o[1]),this.h()},l(n){e=g(n,"DIV",{class:!0});var l=y(e);t=I(l,o[1]),l.forEach(h),this.h()},h(){d(e,"class","err svelte-1jw8pec")},m(n,l){V(n,e,l),c(e,t)},p(n,l){l[0]&2&&G(t,n[1])},d(n){n&&h(e)}}}function de(o){let e,t,n,l=o[0].getState().heat+"",s,r,a,u,i=o[0].getState().cyber+"",f,v,_,w,j=o[0].getState().empathy+"",N,p,m,P,A=o[0].getState().credits+"",F,K,J,D,T=o[0].getState().corpRep+"",U,q,B,S,L;return{c(){e=k("div"),t=k("span"),n=E("♨ "),s=E(l),r=C(),a=k("span"),u=E("⌁ "),f=E(i),v=C(),_=k("span"),w=E("❤ "),N=E(j),p=C(),m=k("span"),P=E("¤ "),F=E(A),K=C(),J=k("span"),D=E("⚑ "),U=E(T),q=C(),B=k("span"),S=E("⏱ "),L=E(o[2]),this.h()},l(M){e=g(M,"DIV",{class:!0});var R=y(e);t=g(R,"SPAN",{title:!0,class:!0});var Y=y(t);n=I(Y,"♨ "),s=I(Y,l),Y.forEach(h),r=O(R),a=g(R,"SPAN",{title:!0,class:!0});var Q=y(a);u=I(Q,"⌁ "),f=I(Q,i),Q.forEach(h),v=O(R),_=g(R,"SPAN",{title:!0,class:!0});var Z=y(_);w=I(Z,"❤ "),N=I(Z,j),Z.forEach(h),p=O(R),m=g(R,"SPAN",{title:!0,class:!0});var $=y(m);P=I($,"¤ "),F=I($,A),$.forEach(h),K=O(R),J=g(R,"SPAN",{title:!0,class:!0});var se=y(J);D=I(se,"⚑ "),U=I(se,T),se.forEach(h),q=O(R),B=g(R,"SPAN",{class:!0,title:!0});var z=y(B);S=I(z,"⏱ "),L=I(z,o[2]),z.forEach(h),R.forEach(h),this.h()},h(){d(t,"title","heat"),d(t,"class","svelte-1jw8pec"),d(a,"title","cyber"),d(a,"class","svelte-1jw8pec"),d(_,"title","empathy"),d(_,"class","svelte-1jw8pec"),d(m,"title","credits"),d(m,"class","svelte-1jw8pec"),d(J,"title","corpRep"),d(J,"class","svelte-1jw8pec"),d(B,"class","turns svelte-1jw8pec"),d(B,"title","turns"),d(e,"class","stats svelte-1jw8pec")},m(M,R){V(M,e,R),c(e,t),c(t,n),c(t,s),c(e,r),c(e,a),c(a,u),c(a,f),c(e,v),c(e,_),c(_,w),c(_,N),c(e,p),c(e,m),c(m,P),c(m,F),c(e,K),c(e,J),c(J,D),c(J,U),c(e,q),c(e,B),c(B,S),c(B,L)},p(M,R){R[0]&1&&l!==(l=M[0].getState().heat+"")&&G(s,l),R[0]&1&&i!==(i=M[0].getState().cyber+"")&&G(f,i),R[0]&1&&j!==(j=M[0].getState().empathy+"")&&G(N,j),R[0]&1&&A!==(A=M[0].getState().credits+"")&&G(F,A),R[0]&1&&T!==(T=M[0].getState().corpRep+"")&&G(U,T),R[0]&4&&G(L,M[2])},d(M){M&&h(e)}}}function pe(o){let e,t,n,l,s,r,a,u,i=o[9]&&_e(o);return{c(){e=k("div"),t=k("button"),n=E("Back"),r=C(),i&&i.c(),this.h()},l(f){e=g(f,"DIV",{class:!0});var v=y(e);t=g(v,"BUTTON",{class:!0,"aria-disabled":!0,title:!0});var _=y(t);n=I(_,"Back"),_.forEach(h),r=O(v),i&&i.l(v),v.forEach(h),this.h()},h(){d(t,"class","btn svelte-1jw8pec"),d(t,"aria-disabled",l=!o[10]),d(t,"title",s=o[10]?"Back":"Nothing to go back to"),re(t,"disabled",!o[10]),d(e,"class","roam svelte-1jw8pec")},m(f,v){V(f,e,v),c(e,t),c(t,n),c(e,r),i&&i.m(e,null),a||(u=W(t,"click",o[23]),a=!0)},p(f,v){v[0]&1024&&l!==(l=!f[10])&&d(t,"aria-disabled",l),v[0]&1024&&s!==(s=f[10]?"Back":"Nothing to go back to")&&d(t,"title",s),v[0]&1024&&re(t,"disabled",!f[10]),f[9]?i?i.p(f,v):(i=_e(f),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(f){f&&h(e),i&&i.d(),a=!1,u()}}}function _e(o){let e,t,n,l;return{c(){e=k("button"),t=E("Back to City"),this.h()},l(s){e=g(s,"BUTTON",{class:!0,title:!0});var r=y(e);t=I(r,"Back to City"),r.forEach(h),this.h()},h(){d(e,"class","btn svelte-1jw8pec"),d(e,"title","Return to City Hub")},m(s,r){V(s,e,r),c(e,t),n||(l=W(e,"click",o[22]),n=!0)},p:ee,d(s){s&&h(e),n=!1,l()}}}function ve(o){let e,t,n,l,s;return{c(){e=k("div"),t=E("Signal live — try "),n=k("code"),l=E("persephone --bloom"),s=E(" in the terminal on the homepage."),this.h()},l(r){e=g(r,"DIV",{class:!0});var a=y(e);t=I(a,"Signal live — try "),n=g(a,"CODE",{});var u=y(n);l=I(u,"persephone --bloom"),u.forEach(h),s=I(a," in the terminal on the homepage."),a.forEach(h),this.h()},h(){d(e,"class","banner svelte-1jw8pec")},m(r,a){V(r,e,a),c(e,t),c(e,n),c(n,l),c(e,s)},d(r){r&&h(e)}}}function ze(o){let e,t=o[14](o[16]())+"",n,l,s=o[4],r=[];for(let a=0;a<s.length;a+=1)r[a]=be(he(o,s,a));return{c(){e=k("div"),n=C(),l=k("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){e=g(a,"DIV",{class:!0});var u=y(e);u.forEach(h),n=O(a),l=g(a,"DIV",{class:!0});var i=y(l);for(let f=0;f<r.length;f+=1)r[f].l(i);i.forEach(h),this.h()},h(){d(e,"class","text svelte-1jw8pec"),d(l,"class","choices svelte-1jw8pec")},m(a,u){V(a,e,u),e.innerHTML=t,V(a,n,u),V(a,l,u);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(l,null)},p(a,u){if(u[0]&264240){s=a[4];let i;for(i=0;i<s.length;i+=1){const f=he(a,s,i);r[i]?r[i].p(f,u):(r[i]=be(f),r[i].c(),r[i].m(l,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=s.length}},d(a){a&&h(e),a&&h(n),a&&h(l),we(r,a)}}}function Je(o){let e,t=o[17]()+"",n,l,s,r=o[14](o[16]())+"",a,u,i,f,v,_,w,j,N;return{c(){e=k("h2"),n=E(t),l=C(),s=k("div"),a=C(),u=k("div"),i=k("button"),f=E("Restart (Short Run)"),v=C(),_=k("button"),w=E("Restart (Long Run)"),this.h()},l(p){e=g(p,"H2",{class:!0});var m=y(e);n=I(m,t),m.forEach(h),l=O(p),s=g(p,"DIV",{class:!0});var P=y(s);P.forEach(h),a=O(p),u=g(p,"DIV",{class:!0});var A=y(u);i=g(A,"BUTTON",{class:!0});var F=y(i);f=I(F,"Restart (Short Run)"),F.forEach(h),v=O(A),_=g(A,"BUTTON",{class:!0});var K=y(_);w=I(K,"Restart (Long Run)"),K.forEach(h),A.forEach(h),this.h()},h(){d(e,"class","ending"),d(s,"class","text svelte-1jw8pec"),d(i,"class","btn svelte-1jw8pec"),d(_,"class","btn svelte-1jw8pec"),d(u,"class","choices ending svelte-1jw8pec")},m(p,m){V(p,e,m),c(e,n),V(p,l,m),V(p,s,m),s.innerHTML=r,V(p,a,m),V(p,u,m),c(u,i),c(i,f),c(u,v),c(u,_),c(_,w),j||(N=[W(i,"click",o[29]),W(_,"click",o[30])],j=!0)},p:ee,d(p){p&&h(e),p&&h(l),p&&h(s),p&&h(a),p&&h(u),j=!1,oe(N)}}}function Ke(o){let e,t,n,l,s,r=o[49].choice.text+"",a,u,i=(o[49].reason||"Requirements not met.")+"",f,v,_,w,j,N;return{c(){e=k("button"),t=k("span"),n=E("·"),l=C(),s=k("span"),a=E(r),u=E(" — "),f=E(i),v=C(),this.h()},l(p){e=g(p,"BUTTON",{class:!0,type:!0,"aria-disabled":!0,tabindex:!0,title:!0,"aria-label":!0});var m=y(e);t=g(m,"SPAN",{class:!0});var P=y(t);n=I(P,"·"),P.forEach(h),l=O(m),s=g(m,"SPAN",{class:!0});var A=y(s);a=I(A,r),u=I(A," — "),f=I(A,i),A.forEach(h),v=O(m),m.forEach(h),this.h()},h(){d(t,"class","num svelte-1jw8pec"),d(s,"class","label"),d(e,"class","choice disabled svelte-1jw8pec"),d(e,"type","button"),d(e,"aria-disabled","true"),d(e,"tabindex","0"),d(e,"title",_=o[49].reason||"Requirements not met."),d(e,"aria-label",w=o[49].choice.text+" — "+(o[49].reason||"Requirements not met."))},m(p,m){V(p,e,m),c(e,t),c(t,n),c(e,l),c(e,s),c(s,a),c(s,u),c(s,f),c(e,v),j||(N=[W(e,"click",Ee(o[27])),W(e,"keydown",Ze)],j=!0)},p(p,m){m[0]&16&&r!==(r=p[49].choice.text+"")&&G(a,r),m[0]&16&&i!==(i=(p[49].reason||"Requirements not met.")+"")&&G(f,i),m[0]&16&&_!==(_=p[49].reason||"Requirements not met.")&&d(e,"title",_),m[0]&16&&w!==(w=p[49].choice.text+" — "+(p[49].reason||"Requirements not met."))&&d(e,"aria-label",w)},d(p){p&&h(e),j=!1,oe(N)}}}function Ge(o){let e,t,n=o[5][o[51]]+1+"",l,s,r,a,u=o[49].choice.text+"",i,f,v,_,w;function j(){return o[31](o[51])}return{c(){e=k("button"),t=k("span"),l=E(n),s=E("."),r=C(),a=k("span"),i=E(u),f=C(),this.h()},l(N){e=g(N,"BUTTON",{class:!0,type:!0});var p=y(e);t=g(p,"SPAN",{class:!0});var m=y(t);l=I(m,n),s=I(m,"."),m.forEach(h),r=O(p),a=g(p,"SPAN",{class:!0});var P=y(a);i=I(P,u),P.forEach(h),f=O(p),p.forEach(h),this.h()},h(){d(t,"class","num svelte-1jw8pec"),d(a,"class","label"),d(e,"class",v="choice "+(o[5][o[51]]===o[11]?"sel":"")+" svelte-1jw8pec"),d(e,"type","button")},m(N,p){V(N,e,p),c(e,t),c(t,l),c(t,s),c(e,r),c(e,a),c(a,i),c(e,f),_||(w=W(e,"click",Ee(j)),_=!0)},p(N,p){o=N,p[0]&32&&n!==(n=o[5][o[51]]+1+"")&&G(l,n),p[0]&16&&u!==(u=o[49].choice.text+"")&&G(i,u),p[0]&2080&&v!==(v="choice "+(o[5][o[51]]===o[11]?"sel":"")+" svelte-1jw8pec")&&d(e,"class",v)},d(N){N&&h(e),_=!1,w()}}}function be(o){let e;function t(s,r){return s[5][s[51]]!==-1?Ge:Ke}let n=t(o),l=n(o);return{c(){l.c(),e=x()},l(s){l.l(s),e=x()},m(s,r){l.m(s,r),V(s,e,r)},p(s,r){n===(n=t(s))&&l?l.p(s,r):(l.d(1),l=n(s),l&&(l.c(),l.m(e.parentNode,e)))},d(s){l.d(s),s&&h(e)}}}function me(o){let e;function t(s,r){return s[15]()?Je:ze}let l=t(o)(o);return{c(){l.c(),e=x()},l(s){l.l(s),e=x()},m(s,r){l.m(s,r),V(s,e,r)},p(s,r){l.p(s,r)},d(s){l.d(s),s&&h(e)}}}function ke(o){let e,t,n,l;function s(u,i){return u[21]().length===0?Qe:Ye}let a=s(o)(o);return{c(){e=k("div"),t=k("h3"),n=E("Lore"),l=C(),a.c(),this.h()},l(u){e=g(u,"DIV",{class:!0});var i=y(e);t=g(i,"H3",{});var f=y(t);n=I(f,"Lore"),f.forEach(h),l=O(i),a.l(i),i.forEach(h),this.h()},h(){d(e,"class","lore svelte-1jw8pec")},m(u,i){V(u,e,i),c(e,t),c(t,n),c(e,l),a.m(e,null)},p(u,i){a.p(u,i)},d(u){u&&h(e),a.d()}}}function Ye(o){let e,t=o[21](),n=[];for(let l=0;l<t.length;l+=1)n[l]=ge(fe(o,t,l));return{c(){for(let l=0;l<n.length;l+=1)n[l].c();e=x()},l(l){for(let s=0;s<n.length;s+=1)n[s].l(l);e=x()},m(l,s){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(l,s);V(l,e,s)},p(l,s){if(s[0]&2097152){t=l[21]();let r;for(r=0;r<t.length;r+=1){const a=fe(l,t,r);n[r]?n[r].p(a,s):(n[r]=ge(a),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(l){we(n,l),l&&h(e)}}}function Qe(o){let e,t;return{c(){e=k("p"),t=E("No lore discovered yet."),this.h()},l(n){e=g(n,"P",{class:!0});var l=y(e);t=I(l,"No lore discovered yet."),l.forEach(h),this.h()},h(){d(e,"class","dim")},m(n,l){V(n,e,l),c(e,t)},p:ee,d(n){n&&h(e)}}}function We(o){let e,t=o[46].summary+"",n;return{c(){e=k("div"),n=E(t),this.h()},l(l){e=g(l,"DIV",{class:!0});var s=y(e);n=I(s,t),s.forEach(h),this.h()},h(){d(e,"class","lsum svelte-1jw8pec")},m(l,s){V(l,e,s),c(e,n)},p:ee,d(l){l&&h(e)}}}function ge(o){let e,t,n=o[46].title+"",l,s,r,a=o[46].summary&&We(o);return{c(){e=k("div"),t=k("div"),l=E(n),s=C(),a&&a.c(),r=C(),this.h()},l(u){e=g(u,"DIV",{class:!0});var i=y(e);t=g(i,"DIV",{class:!0});var f=y(t);l=I(f,n),f.forEach(h),s=O(i),a&&a.l(i),r=O(i),i.forEach(h),this.h()},h(){d(t,"class","ltitle svelte-1jw8pec"),d(e,"class","litem svelte-1jw8pec")},m(u,i){V(u,e,i),c(e,t),c(t,l),c(e,s),a&&a.m(e,null),c(e,r)},p(u,i){u[46].summary&&a.p(u,i)},d(u){u&&h(e),a&&a.d()}}}function Xe(o){let e;function t(s,r){return s[1]?Fe:s[0]?He:qe}let n=t(o),l=n(o);return{c(){l.c(),e=x()},l(s){l.l(s),e=x()},m(s,r){l.m(s,r),V(s,e,r)},p(s,r){n===(n=t(s))&&l?l.p(s,r):(l.d(1),l=n(s),l&&(l.c(),l.m(e.parentNode,e)))},i:ee,o:ee,d(s){l.d(s),s&&h(e)}}}const Ze=o=>{(o.key==="Enter"||o.key===" ")&&o.preventDefault()};function $e(o,e,t){let{json:n=null}=e,{src:l="/story.json"}=e,s=null,r=null,a=0,u=!1,i="",f="",v=!1,_=[],w=[],j=[],N=[],p=0,m=!0,P=!0,A=null,F=!1;const K=3+Math.random()*3,J=Math.random()*2.5;function D(){if(!s)return;const b=s.current();b!=null&&b.id,f=(b==null?void 0:b.title)||"",i=(b==null?void 0:b.text)||"",v=!!(b&&b.type==="ending"),t(4,_=s.renderableChoices()),w=[],j=[],t(5,N=new Array(_.length).fill(-1)),_.forEach((X,le)=>{if(X.enabled){const ne=w.length;w.push(X),j.push(le),t(5,N[le]=ne,N)}});const H=s.getMeta();t(7,m=!(H&&H.ux&&H.ux.showStats===!1)),t(8,P=!!s.getState().canRoam),t(9,A=H&&H.flow&&H.flow.hubNodeId?String(H.flow.hubNodeId):null),t(10,F=s.canBack?s.canBack():!1),t(6,p+=1)}function T(){try{s&&localStorage.setItem(ue,s.serialize()),typeof window<"u"&&window.dispatchEvent(new CustomEvent("persephone:save"))}catch{}}function U(){try{const b=localStorage.getItem(ue);b&&s&&s.deserialize(b)}catch{}}async function q(){try{const b=n||await(await fetch(l,{cache:"no-store"})).json();t(0,s=new Ue(b)),U(),t(2,a=0),D()}catch(b){t(1,r="Failed to initialize the story. Please try again later."),console.warn(b)}}Pe(()=>{q()}),ie.setOptions({breaks:!0,gfm:!0,mangle:!1,headerIds:!1});function B(b){try{const H=(b||"").replace(/\bGotara\b/gi,"Johnny");return ie.parse(H)}catch{return b}}function S(){return v}function L(){return i}function M(){return f}function R(b){s&&(s.choose(b),t(2,a+=1),t(11,z=0),D(),T())}function Y(){s&&(s.reset(),t(2,a=0),D(),T())}function Q(b){if(!s)return;s.reset();const X=(s.current().choices||[]).findIndex(le=>{var ne;return typeof((ne=le.effects)==null?void 0:ne.shortMode)=="boolean"&&le.effects.shortMode===b});X>=0&&(s.choose(X),t(2,a=1),D(),T())}function Z(){return s?s.getLore():[]}function $(){!s||!P||!A||(s.goTo&&s.goTo(A,!0),D(),T())}function se(){if(!s||!P)return;(s.back?s.back():!1)&&(D(),T())}let z=0;function Ie(b){if(!s||S())return;const H=w.length;if((b.key==="ArrowUp"||b.key==="k")&&H>0&&(t(11,z=(z-1+H)%H),b.preventDefault()),(b.key==="ArrowDown"||b.key==="j")&&H>0&&(t(11,z=(z+1)%H),b.preventDefault()),b.key==="Enter"&&H>0&&(R(z),b.preventDefault(),t(11,z=0)),/^[1-9]$/.test(b.key)){const X=parseInt(b.key,10)-1;X>=0&&X<H&&(R(X),b.preventDefault(),t(11,z=0))}}function je(b){Ce.call(this,o,b)}const Ne=()=>t(3,u=!u),Se=()=>Q(!0),Re=()=>Q(!1),Te=b=>{t(11,z=N[b]),R(N[b])};return o.$$set=b=>{"json"in b&&t(25,n=b.json),"src"in b&&t(26,l=b.src)},[s,r,a,u,_,N,p,m,P,A,F,z,K,J,B,S,L,M,R,Y,Q,Z,$,se,Ie,n,l,je,Ne,Se,Re,Te]}class st extends Le{constructor(e){super(),Ve(this,e,$e,Xe,ye,{json:25,src:26},null,[-1,-1])}}export{st as P,ue as S};
